<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Random Chooser Tests</title>
  <link rel="stylesheet" href="qunit.css" type="text/css" media="screen" />
  <script type="text/javascript" src="../js/jquery-1.6.4.min.js"></script>
  <script type="text/javascript" src="../js/json2.js"></script>
  <script type="text/javascript" src="../js/localstorage.js"></script>
  <script type="text/javascript" src="../js/chooser.js"></script>
  <script type="text/javascript" src="qunit.js"></script>

  <script>
$(document).ready(function(){
  QUnit.testStart = function (name) {
    randomChooser.view = randomChooser.createView();
    // ensure other constructs are explosive
    randomChooser.controller = {};
    randomChooser.model = {};
  };
  module("View");
  test("redrawLists - draws list for each name in array", 2, function() {
    var lists = $('#lists');
    lists.constructor.prototype.listview = function (refresh) {};
    equal( lists.children().length, 0);
    randomChooser.createView().redrawLists(['1','2']);
    equal( lists.children().length, 2);
  });
  test("redrawLists - erases list first", 2, function() {
    var lists = $('#lists');
    lists.constructor.prototype.listview = function (refresh) {
      equal (lists.children().length, 0);
      lists.constructor.prototype.listview = function (refresh) {
        equal (lists.children().length, 2);
      };
    };
    randomChooser.view.redrawLists(['1','2']);
  });
  test("addList - adds a line/list item", 2, function() {
    var lists = $('#lists'), child;
    lists.empty();
    equal( lists.children().length, 0);
    randomChooser.view.addList('1'); 
    equal ( lists.children().length, 1);
  });
  test("addList - line/list item has identity of the passed in name", 2, function() {
    var lists = $('#lists'), child;
    lists.empty();
    randomChooser.view.addList('1'); 
    child = lists.children()[0];
    equal (child.nodeName, "LI");
    equal (child.textContent, "1Delete List");
  });
  test("addList - adds 2 anchors", 3, function() {
    var lists = $('#lists'), anchors;
    lists.empty();
    randomChooser.view.addList('1'); 
    anchors = lists.children()[0].childNodes;
    equal( anchors.length, 2);
    equal( anchors[0].nodeName, 'A');
    equal( anchors[1].nodeName, 'A');
  });
  test("addList - first anchor views when clicked", 2, function() {
    var lists = $('#lists'), viewAnchor;
    lists.empty();
    randomChooser.view.addList('1', function(){
      throw "Should not have tried to delete";
    }, function () {
      ok(true);
    }); 
    viewAnchor = lists.children()[0].childNodes[0];
    equal( viewAnchor.text, '1');
    viewAnchor.onclick();
  });
  test("addList - second anchor asks to delete when clicked", 2, function() {
    var lists = $('#lists'), deleteAnchor;
    lists.empty();
    randomChooser.createView().addList('1', function(){
      ok(true);
    }, function () {
      throw "Should not have tried to view";
    });  
    deleteAnchor = lists.children()[0].childNodes[1];
    equal( deleteAnchor.text, 'Delete List');
    deleteAnchor.onclick();
  });
  test("addItem - adds a line/list item", 2, function() {
    var listItems = $('#listItems'), child;
    listItems.empty();
    equal( listItems.children().length, 0);
    randomChooser.view.addItem('1'); 
    equal ( listItems.children().length, 1);
  });
  test("addItem - line/list item has identity of the passed in name", 2, function() {
    var listItems = $('#listItems'), child;
    listItems.empty();
    randomChooser.view.addItem('1'); 
    child = listItems.children()[0];
    equal (child.nodeName, "LI");
    equal (child.textContent, "1Delete Item");
  });
  test("addItem - adds 2 anchors", 3, function() {
    var listItems = $('#listItems'), anchors;
    listItems.empty();
    randomChooser.view.addItem('1'); 
    anchors = listItems.children()[0].childNodes;
    equal( anchors.length, 2);
    equal( anchors[0].nodeName, 'A');
    equal( anchors[1].nodeName, 'A');
  });
  test("addItem - first anchor has identity of item", 1, function() {
    var listItems = $('#listItems'), textAnchor;
    listItems.empty();
    randomChooser.view.addItem('1'); 
    textAnchor = listItems.children()[0].childNodes[0];
    equal( textAnchor.text, '1');
  });
  test("addItem - second anchor asks to delete when clicked", 2, function() {
    var listItems = $('#listItems'), deleteAnchor;
    listItems.empty();
    randomChooser.createView().addItem('1', function () {
      ok(true);
    }); 
    deleteAnchor = listItems.children()[0].childNodes[1];
    equal( deleteAnchor.text, 'Delete Item');
    deleteAnchor.onclick();
  });
  test("drawList - sets list name as title", 1, function() {
    var listNameLabel = $('#listNameLabel');
    $('#listItems').constructor.prototype.listview = function (refresh) {};
    listNameLabel.text = '';
    randomChooser.createView().drawList('1', []);
    equal( $('#listNameLabel').text(), 'list: 1');
  });
  test("drawList - draws item for each name in array", 2, function() {
    var list = $('#listItems');
    list.constructor.prototype.listview = function (refresh) {};
    equal( list.children().length, 0);
    randomChooser.createView().drawList('1', ['1','2']);
    equal( list.children().length, 2);
  });
  test("drawList - erases list first", 2, function() {
    var list = $('#listItems');
    list.constructor.prototype.listview = function (refresh) {
      equal (list.children().length, 0);
      list.constructor.prototype.listview = function (refresh) {
        equal (list.children().length, 2);
      };
    };
    randomChooser.view.drawList('1', ['1','2']);
  });
  test("setRandomDisabled - disabled == true", 2, function() {
    var random = $('#random');
    random.removeClass('ui-disabled');
    equal( random.hasClass('ui-disabled'), false);
    randomChooser.view.setRandomDisabled(true);
    ok( random.hasClass('ui-disabled'));
  });
  test("setRandomDisabled - disabled == false", 2, function() {
    var random = $('#random');
    random.addClass('ui-disabled');
    ok( random.hasClass('ui-disabled'));
    randomChooser.view.setRandomDisabled(false);
    equal(random.hasClass('ui-disabled'), false);
  });
  test("displayItem - sets item name)", 2, function() {
    var itemNameLabel = $('#itemNameLabel'), itemName = 'meh';
    itemNameLabel.text("");
    equal ("", itemNameLabel.text());
    randomChooser.view.displayItem(itemName);
    equal (itemName, itemNameLabel.text());
  });
  test("askToDelete - click handler deletes list", 2, function() {
    var deleteList = $('#delete'), invoked = false;
    $('#deletePage').constructor.prototype.dialog = function (){};
    randomChooser.createView().askToDelete('meh', function () {
      invoked = true;
    });
    ok(!invoked);
    $('#delete').click();
    ok(invoked);
  });
  test("askToDelete - enter invokes click handler", 1, function() {
    var deleteListPage = $('#deletePage'), press;
    deletePage.constructor.prototype.dialog = function (){};
    randomChooser.createView().askToDelete('meh', function () {
      ok(true); // ensure invoked via test count in test invocation
    });
    press = jQuery.Event("keyup");
    press.which = 13;
    press.keyCode = 13;
    deleteListPage.trigger('focus');
    deleteListPage.trigger(press);
  });
});
  </script>
  
</head>
<body>
  <h1 id="qunit-header">Random Chooser Tests</h1>
 <h2 id="qunit-banner"></h2>
 <div id="qunit-testrunner-toolbar"></div>
 <h2 id="qunit-userAgent"></h2>
 <ol id="qunit-tests"></ol>
 <div id="qunit-fixture">
   <div data-role="page" id="firstPage">
      <div data-role="header">
        <h1>random chooser</h1>
      </div>
      <div data-role="content">
        <a href="#addListPage"data-role="button" data-rel="dialog" data-transition="pop">Add List</a>
        <br/> 
        <ul data-role="listview" data-split-icon="delete" data-split-theme="d" id="lists">
        </ul>
      </div>
    </div>
    <div data-role="page" id="addListPage">
      <div data-role="header">
        <h1>add list</h1>
      </div>
      <div data-role="content">
        <div data-role="fieldcontain" class="ui-hide-label">
          <label for="listName">List Name:</label>
          <input type="text" name="listName" id="listName" value="" placeholder="List Name"/>
        </div>
        <a id="addListOk" href="#firstPage" data-role="button" data-rel="back" data-theme="c">OK</a>
      </div>
    </div>
    <div data-role="page" id="viewListPage">
      <div data-role="header">
        <h1 id="listNameLabel"></h1>
      </div>
      <div data-role="content">
        <a href="#addItemPage" data-role="button" data-rel="dialog" data-transition="pop">Add Item</a>
        <a href="#viewItemPage" data-role="button" data-rel="dialog" data-transition="pop" id="random">Select at Random</a>
        <br/> 
        <ul data-role="listview" data-split-icon="delete" data-split-theme="d" id="listItems">
        </ul>
      </div>
    </div>
    <div data-role="page" id="addItemPage">
      <div data-role="header">
        <h1>add item</h1>
      </div>
      <div data-role="content">
        <div data-role="fieldcontain" class="ui-hide-label">
          <label for="itemName">Item Name:</label>
          <input type="text" name="itemName" id="itemName" value="" placeholder="Item Name"/>
        </div>
        <a id="addItemOk" href="#viewListPage" data-role="button" data-rel="back" data-theme="c">OK</a>
      </div>
    </div>
    <div data-role="page" id="viewItemPage">
      <div data-role="header">
        <h1>selected</h1>
      </div>
      <div data-role="content">
        <h1 id="itemNameLabel" align="center"></h1>
        <a data-role="button" id="selectAnother">Select Another</a>
      </div>
    </div>
    <div data-role="page" id="deletePage">
      <div data-role="header">
        <h1>really delete?</h1>
      </div>
      <div data-role="content">
        <h1 id="deleteLabel" align="center"></h1>
        <a data-role="button" id="delete">Yes</a>
      </div>
    </div>
 </div>
</body>
</html>


